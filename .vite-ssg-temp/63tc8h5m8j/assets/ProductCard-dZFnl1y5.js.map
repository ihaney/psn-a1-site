{"version":3,"file":"ProductCard-dZFnl1y5.js","sources":["../../../src/components/ProductCard.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Bookmark } from 'lucide-react';\nimport { queryClient } from '../lib/queryClient';\nimport { Product } from '../types';\nimport { analytics } from '../lib/analytics';\nimport { supabase } from '../lib/supabase';\nimport { useSavedItems } from '../hooks/useSavedItems';\nimport toast from 'react-hot-toast';\n\ninterface ProductCardProps {\n  product: Product;\n}\n\nexport default function ProductCard({ product }: ProductCardProps) {\n  const navigate = useNavigate();\n  const { data: savedItems = [], toggleSavedItem } = useSavedItems();\n  const [imageError, setImageError] = useState(false);\n  const isSaved = savedItems.some(item => item.id === product.id);\n\n  const handleMouseEnter = () => {\n    // Prefetch product details when hovering over the card\n    queryClient.prefetchQuery({\n      queryKey: ['product', product.id],\n      queryFn: async () => {\n        const { data, error } = await supabase\n          .from('Products')\n          .select(`\n            Product_ID,\n            Product_Title,\n            Product_Price,\n            Product_Image_URL,\n            Product_URL,\n            Product_MOQ,\n            Product_Country_Name,\n            Product_Category_Name,\n            Product_Supplier_Name,\n            Product_Source_Name,\n            Product_Supplier_ID\n          `)\n          .eq('Product_ID', product.id)\n          .maybeSingle();\n\n        if (error) throw error;\n        return data;\n      },\n      staleTime: 1000 * 60 * 5 // 5 minutes\n    });\n\n    // Also prefetch supplier contact info if available\n    if (product.supplier) {\n      queryClient.prefetchQuery({\n        queryKey: ['supplierContact', product.id],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('Supplier')\n            .select('Supplier_Email, Supplier_Whatsapp')\n            .eq('Supplier_Title', product.supplier)\n            .maybeSingle();\n\n          if (error) throw error;\n          return data;\n        },\n        staleTime: 1000 * 60 * 5 // 5 minutes\n      });\n    }\n  };\n\n  const handleClick = async () => {\n    // Track analytics\n    analytics.trackEvent('product_click', {\n      props: {\n        product_id: product.id,\n        product_name: product.name,\n        product_category: product.category,\n        product_country: product.country,\n        product_supplier: product.supplier,\n        product_source: product.marketplace,\n        product_price: product.Product_Price\n      }\n    });\n\n    // Record view\n    try {\n      await supabase.rpc('record_product_view', {\n        product_id: product.id\n      });\n    } catch (error) {\n      console.error('Error recording product view:', error);\n    }\n\n    navigate(`/product/${product.id}`);\n  };\n\n  const handleSaveClick = async (e: React.MouseEvent) => {\n    e.stopPropagation();\n    \n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        toast.error('Please log in to save items');\n        return;\n      }\n      \n      await toggleSavedItem(product);\n      toast.success(isSaved ? 'Item removed from saved items' : 'Item saved successfully');\n      \n      analytics.trackEvent(isSaved ? 'item_unsaved' : 'item_saved', {\n        props: {\n          product_id: product.id,\n          product_name: product.name\n        }\n      });\n    } catch (error) {\n      console.error('Error saving item:', error);\n      toast.error('Failed to save item. Please try again.');\n    }\n  };\n\n  const handleImageError = () => {\n    setImageError(true);\n  };\n\n  return (\n    <div className=\"group relative\">\n      <div\n        onMouseEnter={handleMouseEnter}\n        className=\"cursor-pointer\"\n        onClick={handleClick}\n      >\n        <div className=\"aspect-square overflow-hidden rounded-lg bg-gray-800/50 backdrop-blur-sm\">\n          {!imageError ? (\n            <img\n              src={product.image}\n              alt={product.name}\n              className=\"h-full w-full object-cover object-center group-hover:opacity-75 transition-opacity\"\n              onError={handleImageError}\n            />\n          ) : (\n            <div className=\"h-full w-full flex items-center justify-center p-4 group-hover:opacity-75 transition-opacity\">\n              <div className=\"text-center\">\n                <div className=\"w-16 h-16 mx-auto mb-3 bg-gray-700 rounded-lg flex items-center justify-center\">\n                  <svg className=\"w-8 h-8 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" />\n                  </svg>\n                </div>\n                <p className=\"text-gray-400 text-sm\">No image available</p>\n              </div>\n            </div>\n          )}\n        </div>\n        <div className=\"mt-4 flex flex-col min-h-[6rem]\">\n          <h3 className=\"text-sm text-gray-100 mb-2 line-clamp-2\">{product.name}</h3>\n          <div className=\"mt-auto space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <p className=\"text-lg font-medium text-[#F4A024]\">{product.Product_Price}</p>\n            </div>\n            <div className=\"flex flex-col gap-1\">\n              <span className=\"text-xs px-2 py-1 bg-gray-800 rounded-full text-gray-300 inline-block text-center\">\n                {product.category}\n              </span>\n              <span className=\"text-xs px-2 py-1 bg-gray-800 rounded-full text-gray-300 inline-block text-center\">\n                {product.marketplace} â€¢ {product.country}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <button\n        onClick={handleSaveClick}\n        className={`absolute top-2 right-2 p-2 rounded-full transition-colors ${\n          isSaved \n            ? 'bg-gray-800/80 text-[#F4A024]' \n            : 'bg-gray-800/80 text-gray-300 hover:text-[#F4A024]'\n        }`}\n      >\n        <Bookmark className=\"w-5 h-5\" fill={isSaved ? 'currentColor' : 'none'} />\n        <span className=\"sr-only\">{isSaved ? 'Remove from saved' : 'Save item'}</span>\n      </button>\n    </div>\n  );\n}"],"names":["toast"],"mappings":"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"}